---
title: "Prioritizing Vernal Pool Conservation In Worcestor County, Massachusetts"
author: "Michael Jordan"
date: "2024-01-19"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Abstract

Under Massachusetts state law, vernal pools are protected from development. However, to receive this protection, a pool must be certified by the state government. This certification is passive, requested on a volunteer basis by private citizens. The Massachusetts Department of Fish and Wildlife keeps a record of ~30K potential vernal pools that are not certified. To help citizen groups prioritize the certification of potential pools, this paper identifies hot spots of potential pools that are likely to benefit from protection and are under high risk of development.

## Introduction

Vernal pools are ephemeral bodies of water, often geographically separate from other wetlands, that typically fill in the spring and evaporate by summer (Burne & Griffin, 2005).  Because vernal pools are not filled continuously, they do not support breeding fish populations, which makes them critical habitat for amphibian and invertebrate species, particularly those that cannot complete their life cycle in the presence of fish predation (Burne & Griffin, 2005).

In the state of Massachusetts in the United States, vernal pools are understood by the state government to be a “unique and increasingly vulnerable” habitat (MA DFG, 2009). Massachusetts vernal pools are exploited by both species that use the pools on a facultative basis – such as spring peepers (Pseudacris crucifer) – and an obligate basis – such as the wood frog (Lithobates sylvaticus) (MA DFG, 2009). Of particular concern is the intricate fairy shrimp (Eubranchipus intricatus), which completes its life cycle in vernal pools (its eggs are adapted to withstand the drying of the pool) and is listed as a Species of Special Concern under the Massachusetts Endangered Species Act (NHESP, 2015).

Because of their biodiversity significance, vernal pools are protected under a variety of Massachusetts state and local laws, the most significant of which is the Wetlands Protection Act (WPA). Under the WPA, development that may impact that function of vernal pools as wildlife habitat is not permitted within 100 feet of the boundary of a vernal pool (MA DFW, 2009).  However, to qualify for WPA protection, vernal pools must meet two criteria. First, the vernal pool must fall within 100 feet of a wetland “Resource Area” that falls within WPA jurisdiction (MA DFW, 2009). Second, the vernal pool must be certified by the Natural Heritage and Endangered Species Program (NHESP) as functioning biologically as a vernal pool (MA DFW, 2009).

The requirement that a vernal pool fall within WPA jurisdictional resource area is not hugely constraining since WPA jurisdiction is fairly broad, encompassing essentially all wetlands in Massachusetts (310 CMR 10.02 § 1, 1987). However, vernal pool certification significantly constrains protection because it is a passive process conducted on a volunteer basis by private citizens, not an active process by a government body (MA DFW, 2009). If a citizen would like to request certification of a potential vernal pool, they must submit biological data to the NHESP.  Only once approved as a certified vernal pool and only once it has been established that the pool falls under WPA jurisdiction is it protected from development.

To aid the protecting vernal pools, the NHESP has developed a dataset of potential vernal pool GIS coordinates based on aerial photography that took place between 1993 and 2000 (Burne, 2001). Of course, such a dataset may suffer from errors of omission or commission. But, it offers a reasonable starting point for citizens groups interested in preserving vernal pools. However, the volume of records in this data set (29,723 as of January 18, 2024) presents a prioritization problem for citizen groups, which may have limited time and resources to devote to pool certification.

In this project, I aim to contribute to vernal pool conservation in Massachusetts by identifying which pools in the potential vernal pool dataset are more likely to benefit from certification and are more likely to be under threat. Additionally, I hope to identify geographic hot spots of such pools. This information could be used by citizen groups to better target their vernal pool conservation efforts.

## Methods
```{r import, include=FALSE, error=FALSE, warning=FALSE, message=FALSE}
library(dplyr)
library(terra)
library(sf)
library(units)
library(scales)

setwd("C:/Users/Michael Jordan/Desktop/VernalPoolMiniProject")

# Import vectors MA towns, certified pools, potential pools, and wetlands.
ma.towns <- sf::st_read("./townssurvey_shp/TOWNSSURVEY_POLY.shp")
certified.pools <- sf::st_read("./GISDATA_CVP_PT/GISDATA_CVP_PTPoint.shp")
potential.pools <- sf::st_read("./pvp/PVP_PT.shp")
wetlands <- sf::st_read("./wetlandsdep/WETLANDSDEP_POLY.shp")

# Create vectors for just the towns of interest.
cm.towns <- ma.towns[
  ma.towns$TOWN %in% c(
    "HUDSON"), ]
cm.cp <- certified.pools[unlist(
  unique(
    sf::st_intersects(
      x = sf::st_geometry(cm.towns),
      y = sf::st_geometry(sf::st_zm(certified.pools))
    ))), ]
cm.pp <- potential.pools[unlist(
  unique(
    sf::st_intersects(
      x = sf::st_geometry(cm.towns),
      y = sf::st_geometry(sf::st_zm(potential.pools))
    ))), ]
cm.wetlands <- wetlands[unlist(
  unique(
    sf::st_intersects(
      x = sf::st_geometry(cm.towns),
      y = sf::st_geometry(wetlands)
    ))), ]

# Plot potential pools and wetlands versus town boundaries for visual
# inspection.
terra::plot(sf::st_geometry(cm.towns), col = "white")
terra::plot(
  sf::st_geometry(cm.wetlands),
  add = TRUE,
  col = "blue")
terra::plot(
  sf::st_geometry(sf::st_zm(cm.pp)),
  add = TRUE,
  col = "green",
  pch = 17,
  cex = .5)
```

Analysis was completed using `substring(R.Version()$version.string, 1, 15)`, with GIS analysis completed using the terra and sf packages (see Rmd for full code). Data on [municipal boundaries](https://www.mass.gov/info-details/massgis-data-municipalities), [potential vernal pools](https://www.mass.gov/info-details/massgis-data-nhesp-potential-vernal-pools), [wetland boundaries](https://www.mass.gov/info-details/massgis-data-massdep-wetlands-2005), and [land cover/use](https://www.mass.gov/info-details/massgis-data-2016-land-coverland-use) was downloaded from the MassGIS website on January 18, 2024. Potential pools and wetlands were plotted versus municipal boundaries in the NAD83 / Massachusetts Mainland projection and visually inspected for errors.

```{r wetland, error=FALSE, warning=FALSE, message=FALSE}
# Import land use tiles that intersect with towns. To do this, import tile
# indexes, convert to MA projection, get IDs of tiles overlapping with towns,
# create a list to hold tiles, import tiles by name, bind tiles together, and
# convert to MA projection.
tile.index <- sf::st_read(
  "./landcover_use_index_poly/LANDCOVER_USE_INDEX_POLY.shp")
tile.index <- sf::st_transform(tile.index, 26986)
needed.tiles <- tile.index[unlist(
  unique(
    sf::st_intersects(
      x = sf::st_geometry(cm.towns),
      y = sf::st_geometry(tile.index)
    ))), ]$TILENAME
tiles.l <- vector("list", length = length(needed.tiles))
for (i in 1:length(needed.tiles)) {
  shp <- sf::st_read(
    paste("./tiles/LCLU_",
      needed.tiles[i],
      "/LCLU_",
      needed.tiles[i],
      ".shp",
      sep = ""))
  tiles.l[[i]] <- shp[c("COVERCODE", "USEGENCODE")]
}
cm.tiles <- do.call(rbind, tiles.l)
cm.tiles <- sf::st_transform(cm.tiles, 26986)

# Filter tiles to include only polygons intersecting withtowns.
cm.tiles <- cm.tiles[unlist(
  unique(
    sf::st_intersects(
      x = sf::st_geometry(cm.towns),
      y = sf::st_geometry(cm.tiles)
    ))), ]

# Create an object including only polygons describing terrain that could
# indicate a threat to pools.  These are: COVERCODE 2 = Impervious, USEGENCODE 4
# = Industrial, USEGENCODE 7 = Agriculture, USEGENCODE 8 = Recreation,
# USEGENCODE 10 = Mixed use, primarily residential, USEGENCODE 11 = Residential
# - single family, USEGENCODE 12 = Residential - multi-family, USEGENCODE 20 =
# Mixed use, other, USEGENCODE 30 = Mixed use, primarily commercial, USEGENCODE
# 55 = Right-of-way.
cm.tiles.f <- cm.tiles[
  cm.tiles$COVERCODE %in% c(2) |
    cm.tiles$USEGENCODE %in% c(4, 7, 8, 10, 11, 12, 20, 30, 55), ]

# Check whether a potential pool overlaps with a wetland. If it does, set its
# distance to the nearest wetland equal to zero. If it doesn't, calculate its
# distance to the nearest wetland in meters
cm.pp$within.wetland <- lengths(
  sf::st_intersects(cm.pp, cm.wetlands))
cm.pp.ww <- cm.pp[cm.pp$within.wetland == 1, ]
cm.pp.ww$dtw <- 0
cm.pp.nww <- cm.pp[cm.pp$within.wetland == 0, ]
dist <- vector("list", length = nrow(cm.pp.nww))
for (i in 1:nrow(cm.pp.nww)) {
  dist[i] <- units::set_units(
    min(
      sf::st_distance(
        sf::st_geometry(cm.pp.nww)[i],
        sf::st_geometry(cm.wetlands))),
    'ft')
}
cm.pp.nww$dtw <- dist
cm.pp <- rbind(cm.pp.nww, cm.pp.ww)

# Check if pools overlap with an impervious feature. If they do, set their
# distance to the nearest impervious feature equal to zero. If they don't,
# calculate their distance to the nearest impervious feature.
cm.pp$within.feature <- lengths(
  sf::st_intersects(
    sf::st_geometry(cm.pp),
    sf::st_geometry(cm.tiles.f)))
cm.pp.wf <- cm.pp[cm.pp$within.feature == 1, ]
cm.pp.wf$dtf <- 0
cm.pp.nwf <- cm.pp[cm.pp$within.feature == 0, ]
dist2 <- vector("list", length = nrow(cm.pp.nwf))
for (i in 1:nrow(cm.pp.nwf)) {
  dist2[i] <- units::set_units(
    min(
      sf::st_distance(
        sf::st_geometry(cm.pp.nwf)[i],
        sf::st_geometry(cm.tiles.f))),
    'ft')
}
cm.pp.nwf$dtf <- dist2
cm.pp <- rbind(cm.pp.nwf, cm.pp.wf)

# For each potential pool, calculate the distance to the nearest certified pool.
dist3 <- vector("list", length = nrow(cm.pp))
for (i in 1:nrow(cm.pp)) {
  dist3[i] <- units::set_units(
    min(
      sf::st_distance(
        sf::st_geometry(cm.pp)[i],
        sf::st_zm(sf::st_geometry(cm.cp)))),
    'ft')
}
cm.pp$dtcp <- dist3

```
To make the analysis tractable, I chose to focus on a set of towns that (just so happen) to include my hometown.

To determine which potential pools were likely to benefit from certification, I evaluated each pool's proximity to a wetland. Pool points that were inside of a wetland or within 100 feet of the nearest wetland were deemed to be candidates for certification. `r nrow(cm.pp[cm.pp$dtw <= 100, ])`potential pools or `r scales::percent(round(nrow(worcester.pp.f) / nrow(worcester.pp), digits = 2))` of pools in the county passed this threshold.

```{r development, error=FALSE, warning=FALSE, message=FALSE}

```

## Discussion

This analysis suffered from several sources of imprecision, most of which suggest that it is a conservative estimate of vernal pools that could benefit from certification.

First, potential pools were recorded based on visual inspection of aerial photography, which is necessarily open to human error. The NHESP conducted field tests to validate the precision of this methodology and found less than 3% false positives (Burne, 2001). They were not able to determine a false negative rate, but expect that small pools below ~50-60 feet in diameter were not reliably identified (Burne, 2001). This suggests that my estimate is an under count.

Second, there is imprecision around the representation of potential pools as points in two dimensional space. Estimates of potential pool points based on the center of pools in aerial photography had a precision of plus or minus 15 feet (Burne, 2001). Additionally, there is some imprecision inherent in estimating the distance between points after coalescing them from three dimensional to two dimensional space. However, on balance, I believe my estimate of the distance of potential pools to the nearest wetland to be conservative for two reasons. First, because pools could not reliably be identified until were at least 125 feet in diameter, it's likely that most potential pools in the data set are much larger than a 15 foot margin of error. Second, under the WPA, it is not the distance from the pool center to the nearest wetland that determines jurisdiction, it is the distance from the pool boundary to the nearest wetland. By using a 100 foot threshold based on pool center, my estimate is likely to be an undercount.

Finally, potential pool and wetland data cover slightly different time periods (1993-200 vs 2005), both over a decade in the past. Pool location and wetland boundaries may not coincide with their estimated parameters in these data sets today.

## Results

## Conclusion

## Reference List

Burne, R.B. & Griffin, C.R. (2005) Protecting vernal pools: a model from Massachusetts, USA. *Wetlands ecology and management*. Vol.13 (3), 367-375. https://doi.org/10.1007/s11273-004-7528-3

[Guidelines for The Certification of Vernal Pool Habitat](https://www.mass.gov/doc/guidelines-for-the-certification-of-vernal-pool-habitat/download) (2009), Massachusetts Division Of Fisheries & Wildlife.

[Intricate Fairy Shrimp](https://www.mass.gov/doc/intricate-fairy-shrimp/download) (2015), Natural Heritage and Endangered Species Program, Massachusetts Division Of Fisheries & Wildlife.

Burne, R.M. (2001) [Massachusetts Aerial Photo Survey of Potential Vernal Pools](https://www.mass.gov/doc/massachusetts-aerial-photo-survey-of-potential-vernal-pools/download) (2001). Natural Heritage & Endangered Species Program, Massachusetts Division of Fisheries and Wildlife.

[Wetlands Protection Act](https://www.mass.gov/doc/310-cmr-1000-the-wetlands-protection-act/download) (1987)